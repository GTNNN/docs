import{_ as s,o as a,c as n,Q as p}from"./chunks/framework.76cb5871.js";const d=JSON.parse('{"title":"Puppeteer实现 B站自动登录","description":"","frontmatter":{},"headers":[],"relativePath":"Puppeteer实现-B站自动登录.md","filePath":"Puppeteer实现-B站自动登录.md"}'),l={name:"Puppeteer实现-B站自动登录.md"},o=p(`<h1 id="puppeteer实现-b站自动登录" tabindex="-1">Puppeteer实现 B站自动登录 <a class="header-anchor" href="#puppeteer实现-b站自动登录" aria-label="Permalink to &quot;Puppeteer实现 B站自动登录&quot;">​</a></h1><p>创建文件夹<code>puppeteer</code></p><p>创建文件 <code>automate.js</code></p><p>安装 <code>puppeteer</code>，命令如下：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">i</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">puppeteer</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">i</span><span style="color:#24292E;"> </span><span style="color:#032F62;">puppeteer</span></span></code></pre></div><p>安装完成后，记得在 <code>package.json</code>里面补充一些：</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;module&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#6A737D;">// 补充这一句</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;dependencies&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;puppeteer&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;^21.0.2&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;module&quot;</span><span style="color:#24292E;">, </span><span style="color:#6A737D;">// 补充这一句</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;dependencies&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;puppeteer&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;^21.0.2&quot;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>主文件<code>automate.js</code>，内容如下：</p><div class="language-javascript vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> puppeteer </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;puppeteer&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 打开浏览器</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">browser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> puppeteer.</span><span style="color:#B392F0;">launch</span><span style="color:#E1E4E8;">({ headless: </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 打开新页面</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">page</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> browser.</span><span style="color:#B392F0;">newPage</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// 设置页面大小</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">setViewport</span><span style="color:#E1E4E8;">({ width: </span><span style="color:#79B8FF;">1440</span><span style="color:#E1E4E8;">, height: </span><span style="color:#79B8FF;">1080</span><span style="color:#E1E4E8;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">try</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">goto</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;https://www.bilibili.com&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 页面跳转</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForSelector</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;.header-login-entry&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 等待登录按钮元素加载出来</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">loginButton</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;.header-login-entry&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 选择该按钮</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> loginButton.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">// 触发按钮的点击事件</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">waitForSelector</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;.tab__form&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 等待登录表单元素加载出来</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.tab__form .form__item input[type=&quot;text&quot;]&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;在此替换为真实账号&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 自动填充账号</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.tab__form .form__item input[type=&quot;password&quot;]&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;在此替换为真实密码&quot;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 自动填充密码</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Promise</span><span style="color:#E1E4E8;">(</span><span style="color:#FFAB70;">resolve</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">setTimeout</span><span style="color:#E1E4E8;">(resolve, </span><span style="color:#79B8FF;">800</span><span style="color:#E1E4E8;">)); </span><span style="color:#6A737D;">// 设置一些延时，否则会触发B站的登录保护</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">login</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> page.</span><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;.btn_primary&#39;</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 选择表单内的登录按钮</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> login.</span><span style="color:#B392F0;">click</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">// 触发该按钮点击事件实现登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// ......到此处已基本实现自动登录，但是B站有二次验证保护，会弹图片验证框，无法自动处理。</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 基本流程和基本操作已熟悉，学习到此暂且休息。</span></span>
<span class="line"><span style="color:#E1E4E8;">  } </span><span style="color:#F97583;">catch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    console.</span><span style="color:#B392F0;">error</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;发生错误：&quot;</span><span style="color:#E1E4E8;">, error)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">})();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> puppeteer </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;puppeteer&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">(</span><span style="color:#D73A49;">async</span><span style="color:#24292E;"> () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 打开浏览器</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">browser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> puppeteer.</span><span style="color:#6F42C1;">launch</span><span style="color:#24292E;">({ headless: </span><span style="color:#005CC5;">false</span><span style="color:#24292E;"> });</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 打开新页面</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">page</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> browser.</span><span style="color:#6F42C1;">newPage</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// 设置页面大小</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">setViewport</span><span style="color:#24292E;">({ width: </span><span style="color:#005CC5;">1440</span><span style="color:#24292E;">, height: </span><span style="color:#005CC5;">1080</span><span style="color:#24292E;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">try</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">goto</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;https://www.bilibili.com&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 页面跳转</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">waitForSelector</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;.header-login-entry&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 等待登录按钮元素加载出来</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">loginButton</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">$</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;.header-login-entry&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 选择该按钮</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> loginButton.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">// 触发按钮的点击事件</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">waitForSelector</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;.tab__form&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 等待登录表单元素加载出来</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;.tab__form .form__item input[type=&quot;text&quot;]&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;在此替换为真实账号&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 自动填充账号</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;.tab__form .form__item input[type=&quot;password&quot;]&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;在此替换为真实密码&quot;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 自动填充密码</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Promise</span><span style="color:#24292E;">(</span><span style="color:#E36209;">resolve</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">setTimeout</span><span style="color:#24292E;">(resolve, </span><span style="color:#005CC5;">800</span><span style="color:#24292E;">)); </span><span style="color:#6A737D;">// 设置一些延时，否则会触发B站的登录保护</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">login</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> page.</span><span style="color:#6F42C1;">$</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;.btn_primary&#39;</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 选择表单内的登录按钮</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> login.</span><span style="color:#6F42C1;">click</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">// 触发该按钮点击事件实现登录</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// ......到此处已基本实现自动登录，但是B站有二次验证保护，会弹图片验证框，无法自动处理。</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 基本流程和基本操作已熟悉，学习到此暂且休息。</span></span>
<span class="line"><span style="color:#24292E;">  } </span><span style="color:#D73A49;">catch</span><span style="color:#24292E;"> (error) {</span></span>
<span class="line"><span style="color:#24292E;">    console.</span><span style="color:#6F42C1;">error</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;发生错误：&quot;</span><span style="color:#24292E;">, error)</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">})();</span></span></code></pre></div><p>在终端里使用下述命令运行即可（使用 <code>nodemoon</code> 热更新，如未安装可使用 <code>node</code> 命令）：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">nodemoon</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">automate.js</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">nodemoon</span><span style="color:#24292E;"> </span><span style="color:#032F62;">automate.js</span></span></code></pre></div><hr><blockquote><p>📌本次研究过程中，原流程是想通过先打开百度，再通过百度搜索结果第一条进入B站，再登录。但是过程中，遇到 page的加载问题，跳转B 站之后，page 仍是百度那一页的，研究许久不知怎么解决，遂放弃此流程，改为直接打开B站登录。</p></blockquote>`,13),e=[o];function t(c,r,E,y,i,F){return a(),n("div",null,e)}const g=s(l,[["render",t]]);export{d as __pageData,g as default};
